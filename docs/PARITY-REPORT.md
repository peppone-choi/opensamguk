# 패러티 감사 보고서 (Parity Audit Report)

> **감사 기준**: `docs/PARITY-MAP.md` 매핑 기반
> **감사 범위**: 프론트엔드 51+ 페이지 + 백엔드 26 서비스
> **감사 원칙**:
> - 프론트엔드: 레거시(PHP+Vue) = 패러티 소스
> - 백엔드: 레거시 vs core2026 중 더 나은 것 = 패러티 소스 (PARITY-MAP.md B2 기준)

---

## 요약 (Executive Summary)

### 프론트엔드 (51 페이지)

| 상태 | 개수 | 비율 |
|---|---|---|
| ✅ 완전 일치 | 0 | 0% |
| 🟡 부분 일치 | 25 | 49% |
| 🔴 로직 누락/목적 불일치 | 26 | 51% |

### 백엔드 (26 서비스, 131 메서드)

| 상태 | 개수 | 비율 |
|---|---|---|
| ✅ 완전 일치 | 0 | 0% |
| 🟡 부분 일치 | 19 | 73% |
| 🔴 로직 누락/최소 구현 | 7 | 27% |

### 수정 완료 버그 (이전 세션)

| # | 파일 | 내용 |
|---|---|---|
| 1 | `V8__add_missing_tables.sql` | 6개 DB 테이블 누락 |
| 2 | `frontend/src/lib/image.ts` | 이미지 URL `.jpg` 확장자 누락 |
| 3 | `backend/.../GeneralService.kt` | NPC 필터링 `npcState==1` 누락 |
| 4 | `frontend/.../select-npc/page.tsx` | NPC 인수 후 리다이렉트 누락 |
| 5 | `authStore.ts` + `layout.tsx` | Auth guard race condition |

---

## 1. 프론트엔드 상세 감사

### 1.1 인증 (Auth) — 3 페이지

| 페이지 | 상태 | 주요 갭 |
|---|---|---|
| **Login** | 🟡 | OAuth 로그인(카카오) 부재, 자동 토큰 로그인 부재, OTP 2차 인증 부재, 비밀번호 해싱 방식 차이 |
| **Register** | 🟡 | OAuth 회원가입 경로 부재, 이용약관/개인정보 동의 플로우 부재 |
| **Account** | 🔴 | 프로필 표시(닉네임/아이콘) 관리 부재, OAuth 토큰 연동 관리 부재, 동의 철회/탈퇴 플로우 부재 |

### 1.2 로비 (Lobby) — 4 페이지

| 페이지 | 상태 | 주요 갭 |
|---|---|---|
| **Lobby Main** | 🔴 | 멀티서버 게이트웨이 아키텍처 부재 (레거시는 여러 서버 관리), 서버 상태 보드(인원/턴/위상) 부재, 동적 액션 매트릭스(입장/건국/거병 조건별 표시) 부재 |
| **Join** | 🔴 | 성격 선택 UI 부재, 유산 포인트 옵션 표시 부재, **3스탯↔5스탯 모델 불일치** (현재 프론트=5스탯이나 레거시=무력/지력/통솔→프로젝트 전체는 5스탯이므로 OK), 랜덤 장수 프리셋 생성 부재 |
| **Select NPC** | 🔴 | 토큰 카드 플로우 부재 (레거시는 랜덤 5장 카드 중 선택), keep 메커니즘 부재, 전체 NPC 리스트 모달 부재 (토큰 소모 후 열림) |
| **Select Pool** | 🔴 | 듀얼 모드(pick/build/update) 부재, 커스텀 옵션 설정 부재, 토큰 유효성 검증 부재 |

### 1.3 게임 메인 (Main Dashboard) — 1 페이지

| 페이지 | 상태 | 주요 갭 |
|---|---|---|
| **Main** | 🟡 | 이전 세션에서 상세 분석 완료. 기본 대시보드 구조 양호하나 레거시 대비 일부 정보 블록 누락 |

### 1.4 게임 정보열람 (Info/Browse) — 9 페이지

| 페이지 | 상태 | 주요 갭 |
|---|---|---|
| **My General** | 🔴 | **페이지 목적 자체 불일치** — 레거시=세력(국가) 장수 목록, 현재=개인 프로필. 완전히 다른 페이지 |
| **Generals List** | 🟡 | 암행부 권한 기반 접근 제어 부재, 부대/명령 컬럼 부재, 정렬 옵션 15종 vs 제한적 |
| **City** | 🟡 | 첩보/인접도시 기반 정보 제한 부재 (비공개시 `?` 표시), 명령 상세 표시 부재 |
| **My Nation** | 🟡 | 국가열전 로그 부재 |
| **Nations List** | 🟡 | 국가별 상세 블록(수뇌 관직자/속령/장수 일람) 미구현 |
| **Superior** | 🔴 | **read-only(현재) vs 운영성 인사부(레거시)** — 레거시는 임명/추방/외교권자 설정 등 액션 페이지 |
| **My Page** | 🟡 | 사전거병/가오픈 삭제/접경귀환 옵션 부재, 이전 로그 로딩 부재, CSS 설정 부재 |
| **NPC List** | 🟡 | 희생장수/악령 구조 표시 부재, 성격/특기/종능/Lv/명성 컬럼 부재 |
| **Traffic** | 🔴 | **완전 다른 페이지** — 레거시=서버 트래픽 통계(접속자수/시간대), 현재=도시 보급 테이블 |

### 1.5 게임 기능 (Features) — 16 페이지

| 페이지 | 상태 | 주요 갭 |
|---|---|---|
| **Commands** | 🔴 | **핵심 기능 미구현** — 허브 런처만 존재. 턴 예약 테이블/편집(드래그&드롭/클립보드/프리셋/12턴 슬롯) 전체 미구현. `PartialReservedCommand.vue` 대응 없음 |
| **Processing** | 🔴 | **핵심 기능 미구현** — 대기 화면만 존재. 동적 명령 인수 폼(레거시 `ts/processing/*.vue` 13개 Vue 컴포넌트) 전체 미구현. 명령별 도시선택/장수선택/수량입력 등 폼 없음 |
| **Map** | 🟡 | SVG 방식 차이 (레거시=Canvas, 현재=Konva), 레이어 테마/시즌 스타일 부재, 캐시맵 히스토리 부재 |
| **Auction** | 🟡 | buy-rice/sell-rice 분리 부재, 유니크 아이템 익명 입찰 부재, 상세 플로우(입찰/낙찰/유찰) 부재 |
| **Battle Center** | 🟡 | 장수별 딥 드릴다운 부재, 전투 상세 로그 부재, 개인 로그 네비게이션 부재 |
| **Battle Simulator** | 🟡 | 다중 방어자 부재, 국가 컨텍스트 부재, 임포트-익스포트 부재, 고급 컨트롤(지형/성벽/날씨) 부재 |
| **Battle** | 🟡 | 전략 개요 탭(현재) vs 개인 로그 중심(레거시) — 로그 표현 방식 차이 |
| **Board** | 🔴 | 댓글 CRUD API 미연결(UI만 존재), 게시판 API 차이 |
| **Diplomacy** | 🟡 | 문서 체인(제안→수락→이행) 부재, 이중 콘텐츠(공개/외교 전용) 부재, 상세 권한 부재 |
| **History** | 🔴 | **년월 선택기 부재** — 레거시는 년월별 맵 재현/스냅샷 브라우징 가능, 현재는 최근 기록만 표시 |
| **Inherit** | 🟡 | 랜덤 턴 리셋/전투특기 리셋/랜덤 유니크 부재, 경매 연동 부재 |
| **Messages** | 🔴 | **멀티 메일박스 부재** — 레거시=공개/국가/사적/외교 4개 메일박스 + 연락처 그룹 + 이전 메시지 페이징, 현재=단일 리스트 |
| **Troop** | 🟡 | 턴 브리프 부재, 호버 팝업 카드 부재, 명령 타임라인 부재 |
| **Vote** | 🔴 | 댓글 시스템 부재, 다중 선택 제약 부재, 추첨 보상 부재, 관리자 도구 부재 |
| **Betting** | 🟡 | 토너먼트 진행 결합 부재, 위상 게이트 컨트롤 부재 |
| **Tournament** | 🟡 | 위상 관리 부재, 예선-본선 랭킹 테이블 부재, 운영 메시지 부재 |

### 1.6 국가 관리 (Nation Mgmt) — 6 페이지

| 페이지 | 상태 | 주요 갭 |
|---|---|---|
| **Chief Center** | 🟡 | **핵심 턴 예약 편집 부재** — 레거시는 드래그&드롭/클립보드/저장 슬롯으로 12턴 예약 편집 가능. 현재는 execute-only 패러다임 |
| **Nation Generals** | 🟡 | 권한별 컬럼 제어 부재, 부대 매핑 부재, 전투기록 연동 부재 |
| **Nation Cities** | 🔴 | 외교관계 테이블 부재, 국가 방침 편집 부재, 예산 계산 부재 |
| **Internal Affairs** | 🟡 | 외교 현황 표시 부재, 재정 계산 부재, blockWar·blockScout 설정 부재, 리치 텍스트 에디터 부재 |
| **Personnel** | 🔴 | 관직 체계별 UI 부재, 후보 필터 부재, 외교권자 특수 임명 부재, **직급 체크 없이 임명 가능** (보안 문제) |
| **Spy** | 🔴 | 우편함 부재, 비밀 권한 기반 수신자 그룹 부재, 스카우트 메시지 전달 부재 |

### 1.7 NPC 조종 — 1 페이지

| 페이지 | 상태 | 주요 갭 |
|---|---|---|
| **NPC Control** | 🟡 | 대규모 정책 필드군 부재, 이원 우선순위 부재, 설정자 이력 부재 |

### 1.8 랭킹/명예 (Rankings) — 4 페이지

| 페이지 | 상태 | 주요 갭 |
|---|---|---|
| **Best Generals** | 🟡 | 유니크 아이템 소유자 랭킹 부재, 일부 지표 부재 |
| **Emperor** | 🔴 | **역대 왕조 히스토리 부재** — 레거시는 시즌 기록/상세 통계 히스토그램 제공 |
| **Dynasty** | 🟡 | 역대 왕조 기록(phase별 타임라인) 부재 |
| **Hall of Fame** | 🟡 | 시즌/시나리오 필터 부재, 카드형 프레임 미구현 |

### 1.9 관리자 (Admin) — 7 페이지

| 페이지 | 상태 | 주요 갭 |
|---|---|---|
| **Admin Main** | 🔴 | 서버 상태표 부재, 오픈·폐쇄·리셋 제어 부재, ACL 부재, 턴 프리셋 부재 |
| **Admin Members** | 🔴 | 다중 선택 부재, 블럭 단계 부재, 접속 제어 부재, 강제 명령 부재 |
| **Admin Users** | 🔴 | 접속 제한 부재, 암호 초기화 부재, 영구 차단 부재 |
| **Admin Diplomacy** | 🔴 | 국가 종합 지표 부재, 변경 액션 부재, 사보타주 로그 부재 |
| **Admin Logs** | 🔴 | 장수 선택 UI 부재, 상세 패널 부재, 로그 카테고리 분리 부재 |
| **Admin Statistics** | 🔴 | **완전 다른 콘텐츠** — 레거시=외교 관계 테이블, 현재=기본 통계 |
| **Time Control** | 🟡 | 분 단위 조정 부재, 금쌀 지급 부재, 경매 시간 동기 부재 |

---

## 2. 백엔드 상세 감사

### 2.1 서비스별 감사 결과

| 서비스 | 패러티 소스 | 메서드 | 상태 | 주요 갭 |
|---|---|---|---|---|
| **AuthService** | `[C]` | 2 | 🟡 | 세션/토큰 체계 차이, OAuth 미구현 |
| **AccountService** | `[L]` | 4 | 🟡 | 비밀번호/설정/휴가 기본만 구현 |
| **AdminService** | `[C]` | 10 | 🟡 | 오케스트레이터 패턴 부재, 서버 관리 최소 |
| **AuctionService** | `[L]` | 3 | 🔴 | 메시지 기반 최소 구현 — 레거시 9개 API 대비 3개만 |
| **BattleSimService** | `[C]` | 1 | 🔴 | 단순 파워/랜덤 루프 — core2026의 구조적 시뮬레이터 대비 표면적 |
| **CityService** | `[L]` | 3 | 🔴 | 읽기 전용만 — 레거시의 도시 헬퍼/상수/초기화 로직 부재 |
| **CommandService** | `[C]` | 11 | 🟡 | 턴/데몬 패러티 부분적, 커맨드 실행 파이프라인은 존재 |
| **DiplomacyLetterService** | `[L+C]` | 5 | 🟡 | 5개 엔드포인트 존재하나 규칙 깊이 제한 |
| **FrontInfoService** | `[L]` | 1 | 🟡 | 이전 세션에서 감사 완료 |
| **GameConstService** | `[C]` | 5 | 🟡 | 스키마/리소스 부분적 로드 |
| **GameEventService** | `[L]` | 5 | 🔴 | WebSocket 브로드캐스트만 — 레거시의 Event 시스템(StaticEvent/Handler) 부재 |
| **GeneralService** | `[L]` | 11 | 🟡 | CRUD+NPC 기본, 도메인 깊이 부족 (장수 풀/스탯 검증/레벨링 부재) |
| **HistoryService** | `[L]` | 5 | 🟡 | 로깅+읽기 기본 구현 |
| **InheritanceService** | `[L]` | 5 | 🟡 | 레거시 8개 액션 중 일부만 구현 |
| **ItemService** | `[C]` | 3 | 🟡 | 120+ 아이템 로직이 표면적 — core2026은 개별 파일로 완전 분리 |
| **MapService** | `[C]` | 6 | 🟡 | 인접/BFS 알고리즘 존재하나 런타임 맵 기능 부분적 |
| **MessageService** | `[L]` | 9 | 🟡 | 타겟/정찰 부분적 — 레거시의 멀티 메일박스/스카우트 메시지 부재 |
| **NationService** | `[L+C]` | 12 | 🟡 | 정책/관직 기본 구현 존재 |
| **OfficerRankService** | `[L]` | 3 | 🟡 | JSON 룩업 정상 작동 |
| **RankingService** | `[L+C]` | 2 | 🟡 | 기본 랭킹만 구현 |
| **ScenarioService** | `[C]` | 3 | 🟡 | 초기화 파이프라인 존재하나 부분적 (core2026의 82개 시나리오 대비 제한적) |
| **TournamentService** | `[C]` | 4 | 🔴 | 라이프사이클/규칙 미구현 — core2026의 토너먼트 엔진 대비 스텁 수준 |
| **TroopService** | `[L]` | 6 | 🟡 | CRUD 존재하나 검증 로직 약함 |
| **TurnManagementService** | `[C]` | 4 | 🔴 | 데몬 래퍼만 존재 — core2026의 라이프사이클/인메모리 프로세서 부재 |
| **VoteService** | `[L]` | 4 | 🟡 | 기본 CRUD 구현 |
| **WorldService** | `[C]` | 4 | 🔴 | CRUD만 — core2026의 DI/포트 패턴/월드 스냅샷 부재 |

### 2.2 교차 문제 (Cross-cutting Issues)

| 문제 | 위치 | 심각도 |
|---|---|---|
| **에러 핸들링: null/false 반환** | 다수 서비스 | 🔴 — 예외 대신 null 반환으로 실패 원인 불명 |
| **권한 체크 느슨** | Personnel, Admin, Command | 🔴 — 직급/역할 검증 없이 액션 허용 |
| **하드코딩 매직 넘버** | InheritanceService:18, BattleSimService:25, CommandService:319, FrontInfoService:415 | 🟡 — 상수 추출 필요 |
| **트랜잭션 범위** | 다수 서비스 | 🟡 — 복합 연산에 트랜잭션 경계 불명확 |

---

## 3. 우선순위별 개선 로드맵

### P0 — 게임 플레이 차단 (게임이 제대로 안 됨)

| # | 영역 | 내용 |
|---|---|---|
| 1 | **Commands 페이지** | 턴 예약 테이블/편집 구현 (PartialReservedCommand.vue 대응) — 12턴 예약/드래그/프리셋 |
| 2 | **Processing 페이지** | 동적 명령 인수 폼 구현 (processing/*.vue 13개 대응) — 도시/장수/수량 선택 |
| 3 | **Messages 페이지** | 멀티 메일박스 구현 — 공개/국가/사적/외교 분리 |
| 4 | **TurnManagementService** | 턴 데몬 라이프사이클 구현 |
| 5 | **Personnel 페이지** | 직급 체크 추가 (보안 문제) |

### P1 — 핵심 기능 부족 (기능은 있으나 깊이 부족)

| # | 영역 | 내용 |
|---|---|---|
| 6 | **Select NPC** | 토큰 카드 플로우 구현 |
| 7 | **Chief Center** | 턴 예약 편집 (reserve 패러다임) 추가 |
| 8 | **History 페이지** | 년월 선택기 + 스냅샷 브라우징 |
| 9 | **Board 페이지** | 댓글 CRUD API 연결 |
| 10 | **AuctionService** | 레거시 9개 API 패러티 달성 |
| 11 | **BattleSimService** | 구조적 시뮬레이터로 재구현 |
| 12 | **TournamentService** | 라이프사이클/규칙 구현 |
| 13 | **ItemService** | 120+ 아이템 개별 효과 구현 |

### P2 — 정보 표시/UX 갭 (게임은 되지만 정보 부족)

| # | 영역 | 내용 |
|---|---|---|
| 14 | **My General** | 페이지 목적 수정 (세력 장수 목록으로) |
| 15 | **Traffic** | 서버 트래픽 통계 페이지로 수정 |
| 16 | **Superior** | 운영성 인사부 기능 추가 |
| 17 | **Generals List** | 정렬 옵션 확대, 부대/명령 컬럼 추가 |
| 18 | **City** | 첩보 기반 정보 제한 로직 추가 |
| 19 | **Nation Cities** | 외교관계/방침/예산 표시 추가 |
| 20 | **Spy** | 첩보 우편함 + 스카우트 메시지 구현 |

### P3 — 관리자/부가 기능 (운영 도구)

| # | 영역 | 내용 |
|---|---|---|
| 21 | **Admin 전체 (7 페이지)** | 레거시 운영 콘솔 패러티 — 서버 관리/회원 제어/외교 조정/로그 조회 |
| 22 | **Lobby Main** | 멀티서버 게이트웨이 아키텍처 |
| 23 | **Account** | OAuth/프로필/동의 관리 |
| 24 | **Emperor** | 역대 왕조 히스토리 |
| 25 | **Vote** | 댓글/다중선택/추첨 보상 |

---

## 4. 통계

### 프론트엔드 감사 분포

```
Auth (3):     🟡🟡🔴
Lobby (4):    🔴🔴🔴🔴
Main (1):     🟡
Browse (9):   🔴🟡🟡🟡🟡🔴🟡🟡🔴
Features (16): 🔴🔴🟡🟡🟡🟡🟡🔴🟡🔴🟡🔴🟡🔴🟡🟡
Nation (6):   🟡🟡🔴🟡🔴🔴
NPC (1):      🟡
Rankings (4): 🟡🔴🟡🟡
Admin (7):    🔴🔴🔴🔴🔴🔴🟡
```

### 백엔드 감사 분포

```
[C] 패러티: 🔴🔴🟡🟡🟡🟡🔴🟡🔴🔴 (10 서비스)
[L] 패러티: 🔴🔴🔴🟡🟡🟡🟡🟡🟡🟡 (10 서비스)
[L+C] 패러티: 🟡🟡🟡🟡🟡🟡 (6 서비스)
```

### 미구현 레거시 컴포넌트 (현재 대응 없음)

- `AutorunInfo.vue` — 자동실행 정보
- `GeneralLiteCard.vue` — 간이 장수 카드
- `GeneralSupplementCard.vue` — 장수 보충 카드
- `GeneralList.vue` — 장수 리스트 컴포넌트
- `SimpleNationList.vue` — 간이 국가 목록
- `DragSelect.vue` — 드래그 선택 UI
- `NumberInputWithInfo.vue` — 수치 입력 UI
- `TipTap.vue` — 리치 텍스트 에디터
- `BettingDetail.vue` — 베팅 상세
- `BoardArticle.vue` + `BoardComment.vue` — 게시판 컴포넌트
- `AuctionResource.vue` + `AuctionUniqueItem.vue` — 경매 컴포넌트
- `ChiefReservedCommand.vue` — 기밀실 예약명령

### 미구현 core2026 모듈 (현재 대응 없음)

- `logic/items/*.ts` (120+개) — 아이템 개별 효과
- `logic/triggers/special/` (58개) — 특기 개별 효과
- `logic/logging/*.ts` (6개) — 구조화된 로깅
- `game-engine/lifecycle/` (6개) — 턴 라이프사이클
- `resources/turn-commands/default.json` — 턴 커맨드 프로파일

---

## 5. 결론

현재 프로젝트는 **뼈대(CRUD/기본 UI)는 존재하나 도메인 깊이가 부족**한 상태입니다.

- **프론트엔드**: 51개 페이지 중 0개가 완전 일치. 절반(26개)이 로직 누락 또는 목적 불일치.
- **백엔드**: 26개 서비스 중 7개가 최소 구현(스텁 수준). 나머지 19개도 도메인 규칙 깊이 부족.
- **가장 치명적 갭**: Commands/Processing 페이지 (게임의 핵심인 턴 예약/명령 실행 UI 미구현)

**매핑 문서**: 전체 파일 매핑은 `docs/PARITY-MAP.md` 참조 (552줄, 3개 코드베이스 완전 매핑)
